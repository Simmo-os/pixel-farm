name: ğŸ› ï¸ Semi-Auto Setup (Console Output)

# å…è®¸æ‰‹åŠ¨è§¦å‘
on: workflow_dispatch

# èµ‹äºˆä¿®æ”¹æ™®é€šæ–‡ä»¶çš„æƒé™
permissions:
  contents: write

jobs:
  configure-project:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Auto-Modify Files & Generate Config
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            
            // è·å–ä»“åº“å
            const repoName = context.repo.repo;
            console.log(`ğŸ”§ Configuring for repository: ${repoName}`);

            // --- ä»»åŠ¡ 1: ä¿®æ­£ index.html ---
            if (fs.existsSync('index.html')) {
              let html = fs.readFileSync('index.html', 'utf8');
              
              // ç§»é™¤ importmap
              html = html.replace(/<script type="importmap">[\s\S]*?<\/script>/, '');
              
              // æ³¨å…¥å…¥å£è„šæœ¬
              if (!html.includes('src="/index.tsx"')) {
                html = html.replace('</body>', '    <script type="module" src="/index.tsx"></script>\n  </body>');
              }
              
              fs.writeFileSync('index.html', html);
              console.log('âœ… index.html has been updated locally.');
            }

            // --- ä»»åŠ¡ 2: é‡å†™ vite.config.ts ---
            const newViteConfig = `
            import { defineConfig } from 'vite';
            import react from '@vitejs/plugin-react';
            import path from 'path';

            export default defineConfig({
              base: '/${repoName}/',
              plugins: [react()],
              resolve: {
                alias: {
                  '@': path.resolve(__dirname, '.'),
                }
              },
              server: {
                host: '0.0.0.0',
              }
            });
            `;
            fs.writeFileSync('vite.config.ts', newViteConfig.trim());
            console.log('âœ… vite.config.ts has been updated locally.');

            // --- ä»»åŠ¡ 3: ç”Ÿæˆ deploy.yml å†…å®¹å¹¶è¾“å‡ºåˆ°æ§åˆ¶å° ---
            const deployYamlContent = `name: Deploy to GitHub Pages

            on:
              push:
                branches: [ main, master ]
              workflow_dispatch:

            permissions:
              contents: read
              pages: write
              id-token: write

            jobs:
              build:
                runs-on: ubuntu-latest
                steps:
                  - uses: actions/checkout@v4
                  - uses: actions/setup-node@v4
                    with:
                      node-version: 20
                  - run: npm install
                  - run: npm run build
                  - uses: actions/upload-pages-artifact@v3
                    with:
                      path: ./dist
              deploy:
                environment:
                  name: github-pages
                  url: \${{ steps.deployment.outputs.page_url }}
                needs: build
                runs-on: ubuntu-latest
                steps:
                  - id: deployment
                    uses: actions/deploy-pages@v4`;

            // æ‰“å°æ˜¾çœ¼çš„æ—¥å¿—ä¾›å¤åˆ¶
            console.log("\\n\\n" + "=".repeat(60));
            console.log("ğŸ“‹ ã€è¯·å¤åˆ¶ä¸‹æ–¹å†…å®¹ã€‘ ğŸ“‹");
            console.log("ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡ğŸ‘‡");
            console.log(deployYamlContent);
            console.log("ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†ğŸ‘†");
            console.log("=".repeat(60) + "\\n\\n");

      - name: Commit Modified Files
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          # åªæäº¤ index.html å’Œ vite.config.tsï¼Œè¿™ä¸ä¼šè§¦å‘å®‰å…¨æŠ¥é”™
          git add index.html vite.config.ts
          git commit -m "Auto-configure project files (index & vite)" || echo "No changes to commit"
          git push
